# GetOrderStack Development Handoff Document
**Generated:** January 19, 2026 (Session 2)
**Purpose:** Continue development in new conversation

---

## Project Location
```
/Users/jam/development/get-order-stack-restaurant-api
```

## Tech Stack
- **Backend:** Node.js/Express/TypeScript
- **ORM:** Prisma with PostgreSQL (Supabase)
- **AI:** Anthropic Claude for cost estimation, translations, tax lookups
- **Run command:** `npm run dev` (uses tsx watch)
- **Port:** 3000
- **Base URL:** `http://localhost:3000/api/restaurant`

---

## What's Working (Tested Today)

### Restaurant Creation with Auto Tax Lookup ✓
```bash
curl -X POST http://localhost:3000/api/restaurant \
  -H "Content-Type: application/json" \
  -d '{"slug": "my-restaurant", "name": "My Restaurant", "zip": "33444"}'
```
- ZIP 32801 (Orlando) → 6.5% tax
- ZIP 33444 (Delray Beach) → 7% tax
- Auto-saves to DB for future lookups

### Menu Creation with AI Features ✓
- Categories with auto-generated English descriptions
- Menu items with AI cost estimation, suggested pricing, profit margins
- Modifier groups linked to menu items

### Full Order Creation ✓
```bash
curl -X POST http://localhost:3000/api/restaurant/{restaurantId}/orders \
  -H "Content-Type: application/json" \
  -d '{
    "orderType": "pickup",
    "customerInfo": {"firstName": "Jeff", "lastName": "Test", "phone": "5551234567"},
    "items": [{
      "menuItemId": "xxx",
      "quantity": 2,
      "modifiers": [{"modifierId": "yyy"}]
    }]
  }'
```
- Items with modifiers
- Tax calculated at restaurant's rate
- Customer created/linked
- Order number generated

---

## Tax Implementation (Florida Only)

**Current:** Simple calculation
```typescript
const tax = Math.round(subtotal * Number(restaurant.taxRate || 0.07) * 100) / 100;
```

**Why:** Florida taxes food and alcohol at same rate. No category distinction needed.

**Future:** See `/docs/TAX-IMPLEMENTATION-NOTES.md` for:
- StateTaxRule table pattern (when expanding beyond FL)
- Category-based calculation (foodSubtotal vs alcoholSubtotal)
- Same pattern as ZIP lookup: DB → AI → fallback

---

## Key Files

| File | Purpose |
|------|---------|
| `src/app/app.routes.ts` | All API routes (~1100 lines) |
| `src/services/tax.service.ts` | ZIP lookup, tax calculation |
| `src/services/ai-cost.service.ts` | Cost estimation, descriptions |
| `src/services/translation.service.ts` | Google Cloud Translation |
| `prisma/schema.prisma` | Database schema |
| `docs/TAX-IMPLEMENTATION-NOTES.md` | Tax architecture docs |

---

## Database Schema (Key Models)
```prisma
model Restaurant {
  taxRate  Decimal  @default(0.07)  // From ZIP lookup
  state    String   @default("FL")
  // ... address, menu relations, etc.
}

model MenuItem {
  taxCategory  String  @default("prepared_food")
  // "prepared_food", "alcohol", "grocery", "tax_exempt"
  // Currently unused in FL - all same rate
  aiEstimatedCost, aiSuggestedPrice, aiProfitMargin, aiConfidence
}

model TaxJurisdiction {
  zipCode, state, taxRate, breakdown, source
  // Caches ZIP lookups (AI or manual)
}

model Order {
  subtotal, tax, total, status, orderType
  orderItems -> OrderItem[] -> OrderItemModifier[]
}
```

---

## API Endpoints

### Restaurant
- `POST /` - Create (auto tax lookup from ZIP)
- `GET /:id` - Get by ID
- `GET /slug/:slug` - Get by slug
- `PATCH /:id` - Update

### Menu
- `GET /:id/menu` - Full menu with categories, items, modifiers
- `POST /:id/menu/categories` - Create category
- `POST /:id/menu/items` - Create item (AI cost estimation)
- `PATCH /:id/menu/items/:itemId` - Update item
- `POST /:id/menu/items/:itemId/estimate-cost` - Re-run AI estimation

### Modifiers
- `GET /:id/modifiers` - List modifier groups
- `POST /:id/modifiers` - Create group with modifiers
- `PATCH /:id/menu/items/:itemId` with `modifierGroupIds` - Link to item

### Orders
- `POST /:id/orders` - Create order with items + modifiers
- `GET /:id/orders` - List orders
- `PATCH /:id/orders/:orderId/status` - Update status

### Tax
- `GET /tax-rate/:zipCode?state=FL` - Lookup tax rate

---

## Test Data (from today's session)
```
Restaurant: test-orlando
  ID: 96816829-87e3-4b6a-9f6c-613e4b3ab522
  Tax: 6.5%

Category: Entradas
  ID: 75b2e2fd-418a-4ebf-8603-f2e62ddb8b2b

MenuItem: Cuban Sandwich ($12)
  ID: 612ba048-5777-44fa-92ae-39092246af45
  AI Estimated Cost: $4.25
  AI Suggested Price: $13.50

ModifierGroup: Extras
  ID: 7d865226-a154-4b8c-8b85-4a634e9db02c
  - Extra Cheese (+$1.50): 78048922-04eb-4150-a482-02a889095e27
  - Extra Pork (+$3.00): 91127c4a-dba0-40e9-9cfa-1589a7e2e060
  - Add Bacon (+$2.00): d04877f8-38d2-4a60-9aeb-6415ad4f85a9
```

---

## Known Issues / Quirks

### tsx watch doesn't always exit cleanly
```bash
# If port 3000 stuck:
lsof -ti:3000 | xargs kill -9
```

### Prisma relations need connect syntax
```typescript
// Wrong:
menuItemId: menuItem.id

// Right:
menuItem: { connect: { id: menuItem.id } }
```

---

## Next Tasks (Priority Order)

1. **Order status flow** - pending → confirmed → preparing → ready → completed
2. **Stripe payment integration** - checkout flow
3. **Order confirmation** - email/SMS via Resend/Twilio
4. **Angular components** - menu display, cart, checkout
5. **Restaurant dashboard** - live orders, menu management

---

## Jeff's Development Preferences

- Step-by-step with review opportunities
- Separate .html/.scss files for Angular
- Bootstrap 5.3.8 CSS only (no JS)
- Descriptive names over abbreviations
- Bash commands without comments
- TypeScript always

---

## How to Start New Session

1. Start new Claude conversation
2. Paste this document
3. Optionally run: `cat ~/development/get-order-stack-restaurant-api/prisma/schema.prisma` and paste if schema changed
4. State what you want to work on

---

## Documentation Files

- `/docs/TAX-IMPLEMENTATION-NOTES.md` - Full tax architecture and future patterns
- `/docs/HANDOFF-2026-01-19.md` - This file
